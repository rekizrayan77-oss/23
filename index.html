<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Fus√©e Spatiale Ultimate</title>
<style>
body{margin:0;padding:0;height:100vh;overflow:hidden;font-family:Arial,sans-serif;background:linear-gradient(180deg,#000428,#004e92);color:white;}
#gameContainer{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
canvas{background:radial-gradient(circle,#001a33,#000);border:3px solid #00d4ff;box-shadow:0 0 30px #00d4ff80;}
#screen{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#000000dd;z-index:40;}
button{padding:12px 28px;margin:8px;font-size:18px;border:none;border-radius:50px;cursor:pointer;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-weight:bold;}
input{padding:12px 16px;font-size:16px;border:2px solid #00d4ff;border-radius:20px;background:#ffffff22;color:white;text-align:center;}
#scoreDisplay{position:absolute;top:16px;left:16px;font-size:18px;display:flex;gap:12px;align-items:center;z-index:30;}
#pauseBtn{position:absolute;top:16px;right:16px;display:none;z-index:30;}
.podium{padding:15px;margin-top:15px;background:#ffffff22;border-radius:15px;color:#001;}
.podium ol{padding-left:1rem;}
.confettiMsg{font-size:48px;margin-top:12px;animation:pop 900ms ease-out;}
@keyframes pop{0%{transform:scale(.6);opacity:0}60%{transform:scale(1.08);opacity:1}100%{transform:scale(1)}}
.smallText{font-size:14px;opacity:.9}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="scoreDisplay" style="display:none;">
    <div>J: <span id="score">0</span></div>
    <div id="iaScores" class="smallText"></div>
  </div>
  <button id="pauseBtn" style="display:none;">‚è∏ Pause</button>
  <div id="screen"><h1>üöÄ Fus√©e Spatiale üöÄ</h1><button id="startBtn">D√©marrer</button></div>
  <canvas id="game" width="600" height="800"></canvas>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const screen = document.getElementById('screen');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const scoreDisplay = document.getElementById('scoreDisplay');
const scoreSpan = document.getElementById('score');
const iaScoresDiv = document.getElementById('iaScores');

let pseudo = "", score = 0, bestSolo = 0, mode = "solo", difficulty = "easy";
let gameRunning = false, gamePaused = false;
let keys = {}, particleList = [], bullets = [], asteroids = [], bonuses = [], iaPlayers = [], confettiParticles = [];
let asteroidSpawnTimer = 0, asteroidSpawnInterval = 60;
let nextBonusTrigger = 100, BONUS_INTERVAL = 110;
let GAME_WIN_SCORE = 5000;
let laserFireCooldown = 0;
let celebrationActive = false;

const laserSound = new Audio('sounds/laser.mp3');
const bonusSound = new Audio('sounds/bonus.mp3');
const explosionSound = new Audio('sounds/explosion.mp3');
const shieldSound = new Audio('sounds/shield.mp3');
laserSound.volume = 0.6; bonusSound.volume = 0.9; explosionSound.volume = 0.9; shieldSound.volume = 0.8;

let player = { x:280, y:740, w:40, h:60, shield:false, laser:false, bonusTimers:{} };

document.addEventListener('keydown', e=> keys[e.code] = true);
document.addEventListener('keyup', e=> keys[e.code] = false);
startBtn && (startBtn.onclick = menuPseudo);
pauseBtn.onclick = togglePause;

function spawnParticles(x,y,color,size,count,spread=3,life=30){
  for(let i=0;i<count;i++){
    particleList.push({x,y,dx:(Math.random()*2-1)*spread,dy:(Math.random()*2-1)*spread,size:size*(0.6+Math.random()*0.8),life:life*(0.7+Math.random()*0.8),color});
  }
}
function drawParticles(){
  for(let i=particleList.length-1;i>=0;i--){
    const p = particleList[i];
    p.x += p.dx; p.y += p.dy; p.life--;
    ctx.globalAlpha = Math.max(0, p.life/40);
    ctx.fillStyle = p.color;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha = 1;
    if(p.life <= 0) particleList.splice(i,1);
  }
}

function menuPseudo(){
  screen.style.display = 'flex';
  screen.innerHTML = `<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
    <p>Entrez votre pseudo:</p>
    <input id="pseudoInput" maxlength="15" />
    <div><button id="validatePseudo">Valider</button></div>`;
  document.getElementById('validatePseudo').onclick = ()=> {
    pseudo = document.getElementById('pseudoInput').value || 'Joueur';
    menuMain();
  };
}
function menuMain(){
  screen.style.display='flex';
  screen.innerHTML = `<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
    <p>Bonjour ${pseudo}!</p>
    <div><button id="soloBtn">Solo</button><button id="multiBtn">Multijoueur</button></div>`;
  document.getElementById('soloBtn').onclick = ()=> startSolo();
  document.getElementById('multiBtn').onclick = ()=> menuMulti();
}
function menuMulti(){
  screen.style.display='flex';
  screen.innerHTML = `<h1>üöÄ Mode Multi</h1><p>Choisir difficult√© IA</p>
    <div><button id="easyBtn">Facile</button><button id="mediumBtn">Moyen</button><button id="hardBtn">Difficile</button></div>`;
  document.getElementById('easyBtn').onclick = ()=> startMulti('easy');
  document.getElementById('mediumBtn').onclick = ()=> startMulti('medium');
  document.getElementById('hardBtn').onclick = ()=> startMulti('hard');
}

function startSolo(){ mode='solo'; initGame(); }
function startMulti(diff){ mode='multi'; difficulty=diff; initGame(); }

function initGame(){
  screen.style.display='none';
  score = 0; scoreSpan.textContent = score;
  asteroids = []; bonuses = []; particleList = []; bullets = []; iaPlayers = []; confettiParticles = [];
  player = { x:280, y:740, w:40, h:60, shield:false, laser:false, bonusTimers:{} };
  gameRunning = true; gamePaused = false; celebrationActive = false;
  asteroidSpawnInterval = (mode==='multi' && difficulty==='hard') ? 40 : 60;
  scoreDisplay.style.display='flex';
  pauseBtn.style.display='block';
  nextBonusTrigger = 100;
  if(mode==='multi') initIA();
  requestAnimationFrame(gameLoop);
}

function initIA(){
  const colors = ['#ff6b6b','#ffd93d','#6bcf7f','#a29bfe'];
  const names = ['Astro','Nova','Cosmos','Stellar'];
  iaPlayers = [];
  for(let i=0;i<4;i++){
    iaPlayers.push({
      x: 80 + i*120,
      y: 740,
      w:40,h:60,
      color: colors[i],
      name: names[i],
      alive: true,
      dx:0, dy:0,
      speed: (difficulty==='hard'?5:(difficulty==='medium'?4:3)),
      shield:false, laser:false, bonusTimers:{}, score:0, fireCooldown:0
    });
  }
  updateIAScoreDisplay();
}

function movePlayer(){
  if(keys.ArrowLeft && player.x > 0) player.x -= 6;
  if(keys.ArrowRight && player.x + player.w < canvas.width) player.x += 6;
  if(keys.ArrowUp && player.y > 0) player.y -= 4;
  if(keys.ArrowDown && player.y + player.h < canvas.height) player.y += 4;
  if(keys.Space && player.laser && laserFireCooldown <= 0) fireBullet(player);
}

function fireBullet(shooter){
  const speed = 8;
  const bx = shooter.x + shooter.w/2;
  const by = shooter.y;
  bullets.push({ x:bx, y:by, r:6, vx:0, vy:-speed, owner: shooter });
  if(shooter === player){ laserSound && (laserSound.currentTime = 0, laserSound.play()); laserFireCooldown = 12; }
  else shooter.fireCooldown = 12;
}

function drawBullets(){
  for(let i=bullets.length-1;i>=0;i--){
    const b = bullets[i];
    b.x += b.vx; b.y += b.vy;
    ctx.beginPath();
    ctx.fillStyle = '#ff3333';
    ctx.globalAlpha = 0.95;
    ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha = 1;
    spawnParticles(b.x, b.y+2, '#ff8c00', 1, 1, 0.6, 12);
    if(b.y < -20) bullets.splice(i,1);
  }
}

function explodeAt(x,y,intensity=40){
  explosionSound && (explosionSound.currentTime=0, explosionSound.play());
  for(let i=0;i<intensity;i++){
    const c = (Math.random()<0.3) ? '#333' : ['#ff4500','#ff8c00','#ff6347'][Math.floor(Math.random()*3)];
    particleList.push({ x,y, dx:(Math.random()*4-2), dy:(Math.random()*4-2), size:2+Math.random()*4, life:25+Math.random()*30, color:c });
  }
}

// -----------------------
// Bonus logic, asteroid logic, rocket drawing, collisions, IA, game loop
// -----------------------
// (M√™me logique que la version pr√©c√©dente, mais on ajoute au-dessus de chaque fus√©e une UI affichant bonus actif)
// et les IA s'√©vitent mutuellement en v√©rifiant distance minimale entre elles et appliquent une petite force de r√©pulsion.
// -----------------------

menuPseudo();
</script>
</body>
</html>
