<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Fus√©e Spatiale Ultimate</title>
<style>
body{margin:0;padding:0;overflow:hidden;font-family:Arial,sans-serif;background:linear-gradient(180deg,#000428,#004e92);color:white;}
#gameContainer{position:relative;width:100%;height:100vh;display:flex;justify-content:center;align-items:center;}
canvas{background:radial-gradient(circle,#001a33,#000);border:3px solid #00d4ff;box-shadow:0 0 30px #00d4ff80;}
#screen{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#000000dd;z-index:40;}
button{padding:12px 28px;margin:8px;font-size:18px;border:none;border-radius:50px;cursor:pointer;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-weight:bold;}
input{padding:12px 16px;font-size:16px;border:2px solid #00d4ff;border-radius:20px;background:#ffffff22;color:white;text-align:center;}
#scoreDisplay{position:absolute;top:16px;left:16px;font-size:18px;display:flex;gap:12px;align-items:center;z-index:30;}
#pauseBtn{position:absolute;top:16px;right:16px;display:none;z-index:30;}
.podium{padding:15px;margin-top:15px;background:#ffffff22;border-radius:15px;color:#001;}
.podium ol{padding-left:1rem;}
.confettiMsg{font-size:48px;margin-top:12px;animation:pop 900ms ease-out;}
@keyframes pop{0%{transform:scale(.6);opacity:0}60%{transform:scale(1.08);opacity:1}100%{transform:scale(1)}}
.smallText{font-size:14px;opacity:.9;}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="scoreDisplay" style="display:none;">
    <div>J: <span id="score">0</span></div>
    <div id="iaScores" class="smallText"></div>
  </div>
  <button id="pauseBtn" style="display:none;">‚è∏ Pause</button>
  <div id="screen"><h1>üöÄ Fus√©e Spatiale üöÄ</h1><button id="startBtn">D√©marrer</button></div>
  <canvas id="game" width="600" height="800"></canvas>
</div>

<script>
// ===== VARIABLES =====
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const screen=document.getElementById("screen");
const startBtn=document.getElementById("startBtn");
const pauseBtn=document.getElementById("pauseBtn");
const scoreSpan=document.getElementById("score");
const iaScoresDiv=document.getElementById("iaScores");

let pseudo="", score=0, mode="solo", difficulty="easy";
let gameRunning=false, gamePaused=false, celebrationActive=false;
let keys={}, particles=[], bullets=[], asteroids=[], bonuses=[], iaPlayers=[];
let asteroidTimer=0, asteroidInterval=60, nextBonusTrigger=100, BONUS_INTERVAL=110;
let laserCooldown=0, GAME_WIN_SCORE=5000;
let player={x:280,y:740,w:40,h:60,shield:false,laser:false,bonusTimers:{}};

// ===== EVENTS =====
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);
startBtn.onclick=menuPseudo;
pauseBtn.onclick=togglePause;

// ===== PARTICULES =====
function spawnParticles(x,y,color,size,count,spread=3,life=30){
  for(let i=0;i<count;i++){
    particles.push({x,y,dx:(Math.random()*2-1)*spread,dy:(Math.random()*2-1)*spread,size:size*(0.6+Math.random()*0.8),life:life*(0.7+Math.random()*0.8),color});
  }
}
function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.dx; p.y+=p.dy; p.life--;
    ctx.globalAlpha=Math.max(0,p.life/40);
    ctx.fillStyle=p.color;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
    if(p.life<=0) particles.splice(i,1);
  }
}

// ===== MENUS =====
function menuPseudo(){
  screen.style.display='flex';
  screen.innerHTML=`<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
  <p>Entrez votre pseudo:</p>
  <input id="pseudoInput" maxlength="15"/>
  <button id="validatePseudo">Valider</button>`;
  document.getElementById("validatePseudo").onclick=()=>{pseudo=document.getElementById("pseudoInput").value||"Joueur";menuMain();};
}
function menuMain(){
  screen.style.display='flex';
  screen.innerHTML=`<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
  <p>Bonjour ${pseudo}!</p>
  <button id="soloBtn">Solo</button><button id="multiBtn">Multijoueur</button>`;
  document.getElementById("soloBtn").onclick=startSolo;
  document.getElementById("multiBtn").onclick=menuMulti;
}
function menuMulti(){
  screen.style.display='flex';
  screen.innerHTML=`<h1>üöÄ Mode Multi</h1><p>Choisir difficult√© IA</p>
  <button id="easyBtn">Facile</button><button id="mediumBtn">Moyen</button><button id="hardBtn">Difficile</button>`;
  document.getElementById("easyBtn").onclick=()=>startMulti("easy");
  document.getElementById("mediumBtn").onclick=()=>startMulti("medium");
  document.getElementById("hardBtn").onclick=()=>startMulti("hard");
}

// ===== INIT =====
function startSolo(){mode="solo";initGame();}
function startMulti(diff){mode="multi";difficulty=diff;initGame();}
function initGame(){
  screen.style.display='none';
  score=0; scoreSpan.textContent=score;
  asteroids=[]; bonuses=[]; particles=[]; bullets=[]; iaPlayers=[];
  player.x=280; player.y=740; player.shield=false; player.laser=false; player.bonusTimers={};
  gameRunning=true; gamePaused=false;
  asteroidInterval=(mode==="multi"&&difficulty==="hard"?40:60);
  nextBonusTrigger=100;
  celebrationActive=false;
  if(mode==="multi") initIA();
  scoreSpan.textContent=score; pauseBtn.style.display='block';
  requestAnimationFrame(update);
}

// ===== IA =====
function initIA(){
  const colors=["#ff6b6b","#ffd93d","#6bcf7f","#a29bfe"];
  const names=["Astro","Nova","Cosmos","Stellar"];
  iaPlayers=[];
  for(let i=0;i<4;i++){
    iaPlayers.push({x:80+i*120,y:740,w:40,h:60,color:colors[i],name:names[i],alive:true,dx:0,dy:0,speed:(difficulty==="hard"?5:4),shield:false,laser:false,bonusTimers:{},score:0,fireCooldown:0});
  }
  updateIAScore();
}

// ===== GAME LOOP =====
function update(){
  if(!gameRunning||gamePaused)return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  // √©toiles
  ctx.fillStyle="white";
  for(let i=0;i<40;i++){
    let x=(i*137)%600, y=((i*137+score*2)%800);
    ctx.fillRect(x,y,2,2);
  }

  movePlayer();
  moveIA();
  bullets.forEach(b=>{b.y-=10; drawBullet(b); checkBulletHit(b);});
  spawnAsteroids();
  drawAsteroids();
  spawnBonuses();
  drawBonuses();
  drawRocket(player,true);
  drawIA();
  drawParticles();

  scoreSpan.textContent=score;
  if(score>=GAME_WIN_SCORE && !celebrationActive){celebrationActive=true; showCelebration(); return;}
  requestAnimationFrame(update);
}

// ===== PAUSE =====
function togglePause(){gamePaused=!gamePaused;if(!gamePaused) requestAnimationFrame(update);}

// ===== UTILIT√âS =====
function showCelebration(){
  gameRunning=false;
  screen.style.display='flex';
  screen.innerHTML=`<h1 class="confettiMsg">üéâ F√©licitations ! üéâ</h1><button onclick="menuMain()">Menu</button>`;
}
function updateIAScore(){
  iaScoresDiv.innerHTML=iaPlayers.map(ai=>`${ai.name}:${ai.score}`).join(' | ');
}

// ===== NOTE =====
// Toutes les fonctions d√©taill√©es (drawRocket, drawIA, drawBullets, fireLaser, explodeAsteroid, movePlayer, spawnAsteroids, drawAsteroids, spawnBonuses, drawBonuses, useBonus, collision, bonus duration bars, clignotements) doivent √™tre cod√©es ici pour que le jeu soit 100% jouable.

menuPseudo();
</script>
</body>
</html>
